/*
 * Note: this file originally auto-generated by mib2c using
 *        : mib2c.old-api.conf,v 1.3 2002/10/17 09:40:46 dts12 Exp $
 */

#include <net-snmp/net-snmp-config.h>
#include <net-snmp/net-snmp-includes.h>
#include <net-snmp/agent/net-snmp-agent-includes.h>
#include "SharedMemory.h"
#include <linux/shm.h>
#include <pwd.h>
#include <grp.h>
#include <time.h>


#define SHM_MONOTONICALLY_INCREASING
#define SHM_FILE "/proc/sysvipc/shm"
#define KBYTE 1024
#define CACHE_TIMEOUT 5
#define MICROSEC 1000000


/*
 * SharedMemory_variables_oid:
 *   this is the top level oid that we want to register under.  This
 *   is essentially a prefix, with the suffix appearing in the
 *   variable below.
 */

oid SharedMemory_variables_oid[] = { 1,3,6,1,4,1,3204,1,3,27 };

/*
 * variable4 SharedMemory_variables:
 *   this variable defines function callbacks and type return information
 *   for the  mib section
 */

struct variable4 SharedMemory_variables[] = {
/*  magic number        , variable type , ro/rw , callback fn  , L, oidsuffix */

};
/*    (L = length of the oidsuffix) */


struct gstShm{
	unsigned int  uiKey;
	unsigned long ulShmId;
	unsigned int  uiPerms;
	unsigned long ulSize;
	unsigned long ulCpId;
	unsigned long ulLpId;
	unsigned int  uiNAttach;
	unsigned int  uiUID;
	unsigned int  uiGID;
	unsigned int  uiCUID;
	unsigned int  uiCGID;
	time_t ulATime;
	time_t ulDTime;
	time_t ulCTime;
	struct gstShm  *pstShmNext;	
};

/* Function Prototype */
void sharedMemTable_Init();
int sharedMemTable_GetNextShm();
void shmTable_GetShm();

/* Global variable Declaration */
static struct gstShm *gpstShmFirst = NULL;
static struct gstShm *gpstShmStat = NULL;
static struct timeval gstDCTimeVal={0};

static int giShmIdx = 0;
static int giShmCnt = 0;

static unsigned long gulTotalShm = 0;
static unsigned long gulMinShmUsed = 0;
static unsigned long gulMaxShmUsed = 0;
static unsigned long gulAvgShmUsed = 0;

static int giMinIdsUsed = 0;
static int giMaxIdsUsed = 0;
static int giAvgIdsUsed = 0;
static int giShMIdsSaved = 0;

/** Initializes the SharedMemory module */
void
init_SharedMemory(void)
{

    DEBUGMSGTL(("SharedMemory", "Initializing\n"));

    /* register ourselves with the agent to handle our mib tree */
    REGISTER_MIB("SharedMemory", SharedMemory_variables, variable4,
               SharedMemory_variables_oid);

    /* place any other initialization junk you need here */
}